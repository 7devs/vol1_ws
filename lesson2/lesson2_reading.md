#lesson2 课外材料
##毒瘤一、全局变量（global variables）
全局变量就是在**所有作用域**（scope）中都可见的变量。

随着程序变得越来越大，它们很快变得难以管理。在程序中使用全局变量降低了程序的可靠性。
如果某些全局变量的名称碰巧和子程序中的变量名称相同，那么它们将会相互冲突，可能导致程序无法运行，而且通常难以调试。

许多编程语言都有全局变量。JavaScript的问题不仅在于它允许使用全局变量，而且在于它**依赖全局变量**。

共有三种方式定义全局变量：

1. 在任何函数外放置一个`var`语句。
`var foo = value;`
2. 直接给**全局对象**添加一个**属性**。全局对象是所有全局变量的容器。
`window.foo = value;`
3. 直接使用未经声明的变量。这被称为**隐式的全局变量**。
`foo = value;`

JavaScript让那些忘记预先声明的变量称为全局变量，这导致查找bug非常困难。

##毒瘤二、作用域(scope)
JavaScript采用了类似C语言的块语法（block syntax），却没有提供块级作用域（block scope）。
```
块级作用域：代码块中声明的变量在包含此代码块的函数的任何位置都是可见的。
```
在大多数语言中，一般来说，声明变量的最好的地方是在第一次用到它的地方。但这种做法在JavaScript里反而是一个坏习惯，因为它没有块级作用域。

更好的方式是在每个函数的开头部分声明所有变量。


参考资料：
> JavaScript语言精粹(修订版) by Douglas Crockford

Update：
### 为什么要使用块级作用域；

ES5只有全局作用域和函数作用域，没有块级作用域，这带来很多不合理的场景。  
* 第一种场景，内层变量可能会覆盖外层变量。
* 第二种场景，用来计数的循环变量泄露为全局变量。

### ES6的块级作用域

在ES6中，使用 `let` 为JavaScript 增加了块级作用域，比较下面两段代码：

代码一：
```
function f1() {
  var n = 5;
  if (true) {
    var n = 10;
  }
  console.log(n); // 10
}
```

代码二：
```
function f1() {
  let n = 5;
  if (true) {
    let n = 10;
  }
  console.log(n); // 5
}
```

代码一输出：`10`；代码二输出：`5`。
代码二中的函数有两个代码块，都声明了变量n，运行后输出5。这表示外层代码块不受内层代码块的影响。如果使用var（如代码一所示）定义变量n，最后输出的值就是10。

块级作用域的特点：
* 外层作用域无法读取内层作用域的变量。
* 内层作用域可以定义外层作用域的同名变量。

### 全局对象的属性
全局对象是最顶层的对象，在浏览器环境指的是`window`对象，在Node.js指的是`global`对象。ES5之中，全局对象的属性与全局变量是等价的。
```
window.a = 1;
a // 1

a = 2;
window.a // 2
```
上面代码中，全局对象的属性赋值与全局变量的赋值，是同一件事。（对于Node来说，这一条只对REPL环境适用，模块环境之中，全局变量必须显式声明成`global`对象的属性。）

未声明的全局变量，自动成为全局对象window的属性，这被认为是JavaScript语言最大的设计败笔之一。这样的设计带来了两个很大的问题，首先是没法在编译时就报出变量未声明的错误，只有运行时才能知道，其次程序员很容易不知不觉地就创建了全局变量（比如打字出错）。另一方面，从语义上讲，语言的顶层对象是一个有实体含义的对象，也是不合适的。

ES6为了改变这一点，一方面规定，为了保持兼容性，var命令和function命令声明的全局变量，依旧是全局对象的属性；另一方面规定，`let`命令、`const`命令、`class`命令声明的全局变量，不属于全局对象的属性。也就是说，从ES6开始，全局变量将逐步与全局对象的属性脱钩。
```
var a = 1;
// 如果在Node的REPL环境，可以写成global.a
// 或者采用通用方法，写成this.a
window.a // 1

let b = 1;
window.b // undefined
```
上面代码中，全局变量a由`var`命令声明，所以它是全局对象的属性；全局变量b由`let`命令声明，所以它不是全局对象的属性，返回`undefined`。




>[ES6标准入门之块级作用域](https://github.com/ruanyf/es6tutorial/blob/gh-pages/docs/let.md#块级作用域)

>[ES6标准入门之全局对象的属性](https://github.com/ruanyf/es6tutorial/blob/gh-pages/docs/let.md#全局对象的属性)
